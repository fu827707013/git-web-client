# Git Web Client - 界面布局最终设计方案

## 设计参考
参考 **Fork for Mac/Windows** Git 客户端，基于**仓库 Tab 切换 + 左侧导航 + 视图切换**的设计。

**参考截图：**
- `all-commit.png` - All Commits 视图（默认）
- `change.png` - Changes 视图

---

## 核心布局理解

### 关键要点
1. ✅ **顶部有仓库 Tab 标签栏**，可以在多个仓库之间切换
2. ✅ **左侧导航在 Tab 栏下方**，根据当前选中的仓库 Tab 显示对应的分支信息
3. ✅ **没有右侧提交者列表面板**，只有一个完整的提交列表区域
4. ✅ **底部详情面板**在点击提交后显示，包含 Commit/Changes/File Tree 三个标签页

---

## 整体布局结构

```
┌─────────────────────────────────────────────────────────────────────────┐
│ 顶部工具栏                                                               │
│ [快速启动] [拉取] [推送] [暂存] [更多▼]  [主题] [设置]                 │
└─────────────────────────────────────────────────────────────────────────┘
┌─────────────────────────────────────────────────────────────────────────┐
│ 仓库 Tab 标签栏                                                          │
│ [Fork*] [TypeScript*] [react] [my-project] [+]  ← Tab + 添加按钮       │
└─────────────────────────────────────────────────────────────────────────┘
┌──────────────┬──────────────────────────────────────────────────────────┐
│              │                                                          │
│              │              主内容区（上部）                             │
│  左侧导航    │              All Commits View 提交列表                    │
│  (200px)     │              或 Changes View 差异对比                     │
│  固定        │                                                          │
│              │  ┌────────────────────────────────────────────────────┐ │
│ TypeScript   │  │ 🔶 ✓ master  Update package-lock.json             │ │
│ ──────────   │  │ │  Fix getTypeFacts for pattern...               │ │
│ 变更 (11)    │  │ ├─ 🔀 origin/fix41651  Accept new baselines      │ │
│ 所有提交     │  │ └─ 🔀 LEGO: Merge pull request...                │ │
│              │  │                                                    │ │
│ 🔍 筛选      │  │                                                    │ │
│              │  │                                                    │ │
│ ▼ 星标       │  └────────────────────────────────────────────────────┘ │
│   ✓ master   │                                                          │
│ ▼ 分支       │  ────────────────────────────────────────────────────── │
│   master     │                                                          │
│   develop    │              底部详情面板（可折叠，点击提交后显示）        │
│ ▼ 远程       │  ┌────────────────────────────────────────────────────┐ │
│   origin     │  │ [提交详情] [变更文件] [文件树]                      │ │
│ 标签         │  ├────────────────────────────────────────────────────┤ │
│ 暂存         │  │ 作者、SHA、提交消息、变更文件列表...                │ │
│              │  └────────────────────────────────────────────────────┘ │
└──────────────┴──────────────────────────────────────────────────────────┘
```

---

## 详细布局说明

### 1. 顶部工具栏

```
┌─────────────────────────────────────────────────────────────────────────┐
│ [快速启动] [拉取 ↓] [推送 ⤒] [暂存 📋] [更多 ▼]  [🌙] [⚙]            │
└─────────────────────────────────────────────────────────────────────────┘
```

**功能：**
- 快速启动：快速启动面板
- 拉取：拉取并合并远程更新
- 推送：推送到远程仓库
- 暂存：暂存当前更改
- 更多：更多操作菜单
- 🌙：主题切换（深色/浅色）
- ⚙：设置

---

### 2. 仓库 Tab 标签栏

```
┌─────────────────────────────────────────────────────────────────────────┐
│ [Fork*] [TypeScript*] [react] [my-project] [+]                         │
│  激活     激活        未激活      未激活      添加新仓库                  │
└─────────────────────────────────────────────────────────────────────────┘
```

**特性：**
- ✅ 每个 Tab 代表一个已打开的仓库
- ✅ Tab 名称显示仓库名称
- ✅ 星号 (*) 表示有未保存的更改
- ✅ 点击 Tab 切换到对应仓库
- ✅ 点击 [+] 按钮添加新仓库
- ✅ Tab 支持右键关闭、固定等操作
- ✅ 切换 Tab 时，左侧导航的内容会更新为对应仓库的信息

**交互：**
```
用户点击 [TypeScript*] Tab
  ↓
左侧导航刷新为 TypeScript 仓库的分支、标签等信息
  ↓
主内容区显示 TypeScript 仓库的提交列表或变更
```

---

### 3. 左侧导航面板（固定）

> **⚠️ 注意：分支合并、冲突解决等操作暂不开发，仅显示分支列表**

```
┌─────────────────────────┐
│ TypeScript          ⚙  │  ← 当前仓库名称 + 设置
├─────────────────────────┤
│ 📝 变更 (11)            │  ← 点击切换到变更视图
│ 📚 所有提交             │  ← 点击切换到提交历史视图
├─────────────────────────┤
│  Y  🔍  🔄             │  ← 工具按钮
├─────────────────────────┤
│ 🔍 筛选                 │  ← 筛选输入框
├─────────────────────────┤
│ ▼ 星标                  │  ← 星标分支（可折叠显示）
│   ✓ master     ⭐ 🔽   │
├─────────────────────────┤
│ ▼ 分支                  │  ← 本地分支（可折叠显示）
│   editor-support-for... │
│   ✓ master              │  ← 当前分支标记
│   release-4.1           │
├─────────────────────────┤
│ ▼ 远程                  │  ← 远程仓库（可折叠显示）
│   ▶ origin              │  ← 可展开查看远程分支
├─────────────────────────┤
│ 标签                    │  ← 标签列表（可折叠显示）
│ 暂存                    │  ← 暂存列表（暂不开发）
│ 子模块                  │  ← 子模块（暂不开发）
└─────────────────────────┘
```

**本期实现：**
- ✅ 显示当前仓库名称
- ✅ "变更" 视图切换按钮
- ✅ "所有提交" 视图切换按钮
- ✅ 筛选输入框（筛选提交记录或文件）
- ✅ 显示星标分支列表（只读，可折叠）
- ✅ 显示本地分支列表（只读，可折叠）
- ✅ 显示当前分支标记（✓）
- ✅ 显示远程仓库及远程分支列表（只读，可折叠）
- ✅ 显示标签列表（只读，可折叠）
- ✅ 工具按钮操作
- ✅ 点击分支切换到该分支
- ✅ 远程操作（fetch、pull、push）

**后续实现（暂不开发）：**
- 📋 分支创建、删除、重命名
- 📋 分支合并
- 📋 Git 冲突解决
- 📋 星标分支添加/移除操作
- 📋 暂存列表（stash）操作
- 📋 子模块管理

**说明：**
- 显示当前选中 Tab 对应仓库的信息
- 切换 Tab 时，此区域内容会刷新
- "变更" / "所有提交" 按钮控制右侧主内容区显示什么视图
- 分支、标签等列表仅作为信息展示，暂不支持点击操作

---

### 4. 主内容区 - All Commits 视图

点击左侧 "所有提交" 时显示。

**布局类型：Git 历史记录时间线式垂直列表**

```
┌──────────────────────────────────────────────────────────────────┐
│ 提交列表（全宽，带 Git Graph）                                    │
│                                                                  │
│ 🔶 ✓ master  Update package-lock.json          TB  27 Nov 07:21│
│ │  Fix getTypeFacts for pattern template...    #41693  ee57040 │
│ │                                                               │
│ ├─ 🔀 origin/fix41651  Accept new baselines    AH  26 Nov 15:30│
│ │  Add tests for string normalization          #41678  411c6d0 │
│ │                                                               │
│ ├─ ⚠️ replace whole path if directory...       OT  26 Nov 12:45│
│ │  fix(41216): update baseline for test        #41687  3a2b1c4 │
│ │                                                               │
│ └─ 🔀 LEGO: Merge pull request 41678           Bot 25 Nov 18:20│
│    LEGO: check-in for master to temp branch   #41678  86429aa │
│                                                                  │
│ [加载更多...]                                                    │
└──────────────────────────────────────────────────────────────────┘
```

**显示特性：**
- ✅ **垂直流式布局**：每条记录独占一行，自上而下按时间倒序排列，符合 Git 日志的阅读习惯
- ✅ **信息分组清晰**：通过行高、字体大小和颜色对比，将"提交标题"与"附属信息"明确分离
- ✅ **缩写标识**：使用作者名字首字母（如 AH、OT）或 Bot 标识（TB）作为视觉锚点，便于快速定位特定作者的提交
- ✅ **彩色标签系统**：不同颜色代表不同身份或状态（Bot、核心开发者等），提升扫描效率
- ✅ **链接嵌入**：PR 编号（#41693）、commit 哈希（411c6d0）可点击跳转，实现深度追溯
- ✅ **完整宽度**显示提交列表（没有右侧提交者面板）
- ✅ **Git Graph 可视化**：左侧显示分支线条和节点，直观展示分支合并关系
- ✅ **虚拟滚动**：支持大量提交记录的流畅加载

**单条提交记录包含：**
- 提交标题（首行，加粗）
- 作者缩写标识（TB、AH、OT 等）
- 提交时间（相对时间或绝对时间）
- PR 编号（可点击）
- Commit SHA 短码（可点击）
- 分支标签和图标

**交互：**
- 单击提交行 → 底部详情面板展开，显示该提交的详细信息
- 右键提交行 → 显示上下文菜单（复制SHA、查看差异、下载等）
- 点击 PR 编号 → 跳转到 PR 详情（如果关联远程仓库）
- 点击 SHA → 复制完整 SHA 或跳转到提交详情
- 多选提交 → 支持批量操作（下载、比较等）

---

### 5. 主内容区 - Changes 视图

点击左侧 "变更 (11)" 时显示。

**布局类型：左右分栏（左侧文件列表 + 右侧差异查看）**

```
┌────────────────────────────────────────────────────────────────────────────┐
│                          Changes 视图（左右分栏）                           │
├──────────────────────────────────┬─────────────────────────────────────────┤
│ 左侧：文件列表区（30-40%）        │ 右侧：差异查看区（60-70%，暂不开发）     │
│                                  │                                         │
│ ┌────────────────────────────┐   │                                         │
│ │ Unstaged (8)      [Stage All]│   │  [预留布局]                             │
│ ├────────────────────────────┤   │                                         │
│ │ ▼ 📁 src/                  │   │  选中文件后，此处显示：                  │
│ │   ▼ 📁 compiler/           │   │                                         │
│ │     ➕ 📄 checker.ts    M  │   │  - 代码差异对比                          │
│ │     ➕ 📄 parser.ts     M  │   │    （左右并排对比模式）                  │
│ │   ▼ 📁 services/           │   │  - 语法高亮                              │
│ │     ➕ 📄 completions.ts M │   │  - 删除行标红/添加行标绿                │
│ │     ➕ 📄 utilities.ts  D  │   │  - 行号显示                              │
│ │ ▼ 📁 tests/                │   │                                         │
│ │   ➕ 📄 test.spec.ts    A  │   │  （暂不开发，后续实现）                  │
│ └────────────────────────────┘   │                                         │
│                                  │                                         │
│ ┌────────────────────────────┐   │                                         │
│ │ Staged (3)    [Unstage All]│   │                                         │
│ ├────────────────────────────┤   │                                         │
│ │ ➖ 📄 package.json      M  │   │                                         │
│ │ ➖ 📄 README.md         M  │   │                                         │
│ │ ➖ 📄 tsconfig.json     M  │   │                                         │
│ └────────────────────────────┘   │                                         │
│                                  │                                         │
│ ──────────────────────────────── │                                         │
│ 提交信息：                        │                                         │
│ ┌────────────────────────────┐   │                                         │
│ │ 输入提交消息...             │   │                                         │
│ └────────────────────────────┘   │                                         │
│ [提交] [放弃所有变更]             │                                         │
└──────────────────────────────────┴─────────────────────────────────────────┘
```

**布局说明：**
- **Unstaged 卡片**：显示未暂存的文件（工作区变更）
  - 头部：标题 "Unstaged (数量)" + "Stage All" 按钮
  - 内容：文件目录树结构，文件前显示 ➕ 图标
- **Staged 卡片**：显示已暂存的文件（暂存区）
  - 头部：标题 "Staged (数量)" + "Unstage All" 按钮
  - 内容：文件列表（平铺或树形），文件前显示 ➖ 图标
- **提交区**：提交信息输入框 + 提交按钮

**本期实现特性（左侧文件列表区）：**
- ✅ Unstaged 卡片（未暂存文件）
- ✅ Staged 卡片（已暂存文件）
- ✅ 文件以目录树结构显示（Unstaged 区域）
- ✅ 文件状态标识（M=Modified, A=Added, D=Deleted）
- ✅ 文件夹可折叠/展开
- ✅ 点击文件前的 ➕ 图标 → 暂存该文件
- ✅ 点击文件前的 ➖ 图标 → 取消暂存该文件
- ✅ "Stage All" 按钮 → 暂存所有未暂存文件
- ✅ "Unstage All" 按钮 → 取消暂存所有已暂存文件
- ✅ 提交信息输入框
- ✅ 提交按钮（提交已暂存文件）
- ✅ 放弃所有变更按钮

**后续实现（右侧差异查看区，暂不开发）：**
- 📋 点击文件在右侧显示差异对比
- 📋 Side-by-Side 并排对比模式
- 📋 语法高亮
- 📋 行号显示
- 📋 删除行标红、添加行标绿
- 📋 差异统计（+123 -45）

**交互：**
- 点击 ➕ 图标 → 暂存该文件（从 Unstaged 移到 Staged）
- 点击 ➖ 图标 → 取消暂存该文件（从 Staged 移到 Unstaged）
- 点击 "Stage All" → 暂存所有未暂存文件
- 点击 "Unstage All" → 取消暂存所有已暂存文件
- 单击文件名 → 选中文件（高亮显示，后续在右侧显示差异）
- 输入提交消息 + 点击 "提交" → 创建提交

---

### 6. 底部详情面板

**仅在 All Commits 视图中**，点击提交后显示。

```
┌─────────────────────────────────────────────────────────────────────┐
│ [Commit] [Changes] [File Tree]  ← Tabs                             │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  (根据选中的 Tab 显示不同内容)                                       │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

#### 6.1 Commit 标签页

```
┌──────────────────────────────────────────────────────────────┐
│ AUTHOR                          COMMITTER                     │
│ 👤 csigs                        👤 GitHub                     │
│    csigs@users.noreply.github   noreply@github.com            │
│    25 Nov 2020 01:11:30         25 Nov 2020 01:11:30          │
│                                                                │
│ SHA      86429aae330aa076f9c776c785cd47c69044187a            │
│ PARENTS  5adb55e  dbcbe93   ← 可点击跳转                      │
│                                                                │
│ ─────────────────────────────────────────────────────────────│
│                                                                │
│ LEGO: Merge pull request 41678                                │
│                                                                │
│ LEGO: Merge pull request 41678                                │
│                                                                │
│                                           [Expand All]          │
│                                                                │
│ ▶ 📁 src/loc/lcl/fra/diagnosticMessages/                     │
│ ▶ 📁 src/loc/lcl/ita/diagnosticMessages/                     │
└──────────────────────────────────────────────────────────────┘
```

**显示内容：**
1. 作者和提交者信息（头像、姓名、邮箱、时间）
2. 提交 SHA 和父提交 SHA
3. 完整提交消息
4. 变更文件树（可展开/折叠）

#### 6.2 Changes 标签页

```
┌──────────────────────────────────────────────────────────────┐
│ 📊 Files Changed: 15  +523  -187                             │
│                                                                │
│ ▼ 📁 src/compiler/                                           │
│   │  📄 checker.ts                          +45  -12    M    │
│   │  📄 parser.ts                           +102 -35   M    │
│   │                                                            │
│ ▼ 📁 src/services/                                           │
│   │  📄 completions.ts                      +67  -8    M    │
│   │  📄 utilities.ts                        +0   -132  D    │
│   │                                                            │
│ ▶ 📁 tests/                                                   │
│                                                                │
│ [展开所有] [折叠所有] [仅显示已修改]                          │
└──────────────────────────────────────────────────────────────┘
```

**显示内容：**
- 变更文件统计
- 树形文件列表
- 每个文件的添加/删除行数
- 文件状态（M=Modified, A=Added, D=Deleted）

#### 6.3 File Tree 标签页

```
┌──────────────────────────────────────────────────────────────┐
│ 📁 完整仓库文件树                                              │
│ ▼ 📁 src/                                                     │
│   ├ 📁 compiler/                                              │
│   │  ├ 📄 checker.ts                                          │
│   │  ├ 📄 parser.ts                                           │
│   │  └ 📄 binder.ts                                           │
│   └ 📁 services/                                              │
│      ├ 📄 completions.ts                                      │
│      └ 📄 utilities.ts                                        │
└──────────────────────────────────────────────────────────────┘
```

**显示内容：**
- 该提交时刻的完整文件树
- 可展开/折叠文件夹
- 显示文件图标

---

## 响应式设计

### 只支持桌面端
- 仓库 Tab 栏：全宽
- 左侧面板：200px 固定
- 主内容区：自适应
- 底部面板：可调整高度，默认 300px

---

## 实施步骤

### 第一阶段：基础框架
1. ✅ 创建主布局组件
2. ✅ 实现顶部工具栏
3. ✅ 实现仓库 Tab 标签栏（静态）
4. ✅ 实现左侧面板（静态）
5. ✅ 实现视图切换容器

### 第二阶段：仓库 Tab 功能
1. ✅ Tab 点击切换
2. ✅ Tab 添加功能
3. ✅ Tab 关闭功能
4. ✅ Tab 右键菜单
5. ✅ 切换 Tab 时刷新左侧导航

### 第三阶段：左侧导航功能
1. ✅ 视图切换按钮（Changes / All Commits）
2. ✅ 分支树组件
3. ✅ 筛选功能
4. ✅ 星标分支功能

### 第四阶段：All Commits 视图
1. ✅ 提交列表组件
2. ✅ Git Graph 可视化
3. ✅ 底部详情面板
4. ✅ 三个标签页（Commit/Changes/File Tree）

### 第五阶段：Changes 视图
> **⚠️ 此阶段暂不开发差异查看器，冲突处理，只开放基础功能，保留规划供后续实现**

1. 📋 差异查看器（Side-by-Side）（暂不实施）
2. 📋 暂存/未暂存文件列表
3. 📋 文件操作（stage、unstage、discard）（暂不实施）

### 第六阶段：优化完善
1. ✅ 响应式适配
2. ✅ 主题切换
3. ✅ 性能优化
4. ✅ 快捷键支持

---

## 总结

核心设计要点：

✅ **仓库 Tab 在顶部**，支持多仓库切换
✅ **左侧导航在 Tab 下方**，显示当前仓库信息
✅ **主内容区全宽显示**，没有右侧提交者面板
✅ **底部详情面板**仅在点击提交后显示
✅ **视图切换**通过左侧导航的按钮控制

**请确认此设计方案，确认后我将开始代码实施。**
